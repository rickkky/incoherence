{"version":3,"file":"incoherence.cjs.production.min.js","sources":["../src/debounce.ts","../src/throttle.ts"],"sourcesContent":["const defaultGap = 128\n\nconst defaultOptions = {\n  maxGap: Infinity,\n  immediate: true,\n}\n\nfunction debounce<A extends [], R>(\n  func: (...args: A) => R,\n  gap = defaultGap,\n  options: Partial<typeof defaultOptions> = defaultOptions,\n) {\n  if (gap <= 0 || !Number.isFinite(gap)) {\n    gap = defaultGap\n  }\n\n  let { maxGap, immediate } = defaultOptions\n\n  if (options && options !== defaultOptions) {\n    if (\n      options.maxGap &&\n      Number.isFinite(options.maxGap) &&\n      options.maxGap >= gap\n    ) {\n      maxGap = options.maxGap\n    }\n\n    if (typeof options.immediate === 'boolean') {\n      immediate = options.immediate\n    }\n  }\n\n  let shouldExecute = immediate\n  let gapTimer: ReturnType<typeof setTimeout> | undefined\n  let maxGapTimer: ReturnType<typeof setTimeout> | undefined\n  let lastReject: ((reason?: any) => void) | undefined\n\n  function skipLastInvoke() {\n    if (gapTimer) {\n      clearTimeout(gapTimer)\n    }\n\n    if (lastReject) {\n      lastReject({ message: 'Cancelled by debounce.' })\n    }\n\n    gapTimer = undefined\n    lastReject = undefined\n  }\n\n  function resetMaxGapTimer() {\n    if (!Number.isFinite(maxGap)) {\n      return\n    }\n\n    if (maxGapTimer) {\n      clearTimeout(maxGapTimer)\n    }\n\n    maxGapTimer = setTimeout(() => {\n      shouldExecute = true\n    }, maxGap)\n  }\n\n  function resetForImmediateExecution() {\n    if (!immediate) {\n      return\n    }\n\n    gapTimer = setTimeout(() => {\n      shouldExecute = true\n    }, gap)\n  }\n\n  function resetAfterExecution() {\n    gapTimer = undefined\n    lastReject = undefined\n\n    resetMaxGapTimer()\n    resetForImmediateExecution()\n  }\n\n  function execute(this: any, args: A, resolve: (value?: R) => void) {\n    resolve(func.apply(this, args))\n    resetAfterExecution()\n  }\n\n  function handle(\n    this: any,\n    args: A,\n    resolve: (value?: R) => void,\n    reject: (reason?: any) => void,\n  ) {\n    skipLastInvoke()\n\n    if (shouldExecute) {\n      setTimeout(execute.bind(this, args, resolve), 0)\n      shouldExecute = false\n    } else {\n      gapTimer = setTimeout(execute.bind(this, args, resolve), gap)\n      lastReject = reject\n    }\n  }\n\n  function debounced(this: any, ...args: A): Promise<R> {\n    const promise = new Promise<R>(handle.bind(this, args))\n\n    promise.catch((reason) => reason)\n\n    return promise\n  }\n\n  return debounced\n}\n\nexport { debounce }\n\nexport default debounce\n","import debounce from './debounce'\n\nconst defaultGap = 128\n\nfunction throttle<A extends [], R>(func: (...args: A) => R, gap = defaultGap) {\n  if (gap <= 0 || !Number.isFinite(gap)) {\n    gap = defaultGap\n  }\n\n  return debounce(func, gap, { maxGap: gap, immediate: true })\n}\n\nexport { throttle }\n\nexport default throttle\n"],"names":["defaultGap","defaultOptions","maxGap","Infinity","immediate","debounce","func","gap","options","Number","isFinite","gapTimer","maxGapTimer","lastReject","shouldExecute","execute","args","resolve","apply","this","undefined","clearTimeout","setTimeout","handle","reject","message","bind","promise","Promise","reason"],"mappings":"aAAA,IAAMA,EAAa,IAEbC,EAAiB,CACrBC,OAAQC,SACRC,WAAW,GAGb,SAASC,EACPC,EACAC,EACAC,YADAD,IAAAA,EAAMP,YACNQ,IAAAA,EAA0CP,IAEtCM,GAAO,IAAME,OAAOC,SAASH,MAC/BA,EAAMP,OAGFE,EAAsBD,EAAtBC,OAAQE,EAAcH,EAAdG,UAEVI,GAAWA,IAAYP,IAEvBO,EAAQN,QACRO,OAAOC,SAASF,EAAQN,SACxBM,EAAQN,QAAUK,IAElBL,EAASM,EAAQN,QAGc,kBAAtBM,EAAQJ,YACjBA,EAAYI,EAAQJ,gBAKpBO,EACAC,EACAC,EAHAC,EAAgBV,WAkDXW,EAAmBC,EAASC,GACnCA,EAAQX,EAAKY,MAAMC,KAAMH,IARzBL,OAAWS,EACXP,OAAaO,EAzBRX,OAAOC,SAASR,KAIjBU,GACFS,aAAaT,GAGfA,EAAcU,YAAW,WACvBR,GAAgB,IACfZ,IAIEE,IAILO,EAAWW,YAAW,WACpBR,GAAgB,IACfP,aAgBIgB,EAEPP,EACAC,EACAO,GArDIb,GACFU,aAAaV,GAGXE,GACFA,EAAW,CAAEY,QAAS,2BAGxBd,OAAWS,EACXP,OAAaO,EAgDTN,GACFQ,WAAWP,EAAQW,KAAKP,KAAMH,EAAMC,GAAU,GAC9CH,GAAgB,IAEhBH,EAAWW,WAAWP,EAAQW,KAAKP,KAAMH,EAAMC,GAAUV,GACzDM,EAAaW,gDAIgBR,2BAAAA,sBACzBW,EAAU,IAAIC,QAAWL,EAAOG,KAAKP,KAAMH,WAEjDW,SAAc,SAACE,UAAWA,KAEnBF,uCCzGX,SAAmCrB,EAAyBC,mBAAAA,IAAAA,EAFzC,MAGbA,GAAO,IAAME,OAAOC,SAASH,MAC/BA,EAJe,KAOVF,EAASC,EAAMC,EAAK,CAAEL,OAAQK,EAAKH,WAAW"}