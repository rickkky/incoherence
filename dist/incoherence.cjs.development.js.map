{"version":3,"file":"incoherence.cjs.development.js","sources":["../src/debounce.ts","../src/throttle.ts"],"sourcesContent":["const defaultGap = 128\n\nconst defaultOptions = {\n  maxGap: Infinity,\n  immediate: true,\n}\n\nfunction debounce<A extends [], R>(\n  func: (...args: A) => R,\n  gap = defaultGap,\n  options: Partial<typeof defaultOptions> = defaultOptions,\n) {\n  if (gap <= 0 || !Number.isFinite(gap)) {\n    gap = defaultGap\n  }\n\n  let { maxGap, immediate } = defaultOptions\n\n  if (options && options !== defaultOptions) {\n    if (\n      options.maxGap &&\n      Number.isFinite(options.maxGap) &&\n      options.maxGap >= gap\n    ) {\n      maxGap = options.maxGap\n    }\n\n    if (typeof options.immediate === 'boolean') {\n      immediate = options.immediate\n    }\n  }\n\n  let shouldExecute = immediate\n  let gapTimer: ReturnType<typeof setTimeout> | undefined\n  let maxGapTimer: ReturnType<typeof setTimeout> | undefined\n  let lastReject: ((reason?: any) => void) | undefined\n\n  function skipLastInvoke() {\n    if (gapTimer) {\n      clearTimeout(gapTimer)\n    }\n\n    if (lastReject) {\n      lastReject({ message: 'Cancelled by debounce.' })\n    }\n\n    gapTimer = undefined\n    lastReject = undefined\n  }\n\n  function resetMaxGapTimer() {\n    if (!Number.isFinite(maxGap)) {\n      return\n    }\n\n    if (maxGapTimer) {\n      clearTimeout(maxGapTimer)\n    }\n\n    maxGapTimer = setTimeout(() => {\n      shouldExecute = true\n    }, maxGap)\n  }\n\n  function resetForImmediateExecution() {\n    if (!immediate) {\n      return\n    }\n\n    gapTimer = setTimeout(() => {\n      shouldExecute = true\n    }, gap)\n  }\n\n  function resetAfterExecution() {\n    gapTimer = undefined\n    lastReject = undefined\n\n    resetMaxGapTimer()\n    resetForImmediateExecution()\n  }\n\n  function execute(this: any, args: A, resolve: (value?: R) => void) {\n    resolve(func.apply(this, args))\n    resetAfterExecution()\n  }\n\n  function handle(\n    this: any,\n    args: A,\n    resolve: (value?: R) => void,\n    reject: (reason?: any) => void,\n  ) {\n    skipLastInvoke()\n\n    if (shouldExecute) {\n      setTimeout(execute.bind(this, args, resolve), 0)\n      shouldExecute = false\n    } else {\n      gapTimer = setTimeout(execute.bind(this, args, resolve), gap)\n      lastReject = reject\n    }\n  }\n\n  function debounced(this: any, ...args: A): Promise<R> {\n    const promise = new Promise<R>(handle.bind(this, args))\n\n    promise.catch((reason) => reason)\n\n    return promise\n  }\n\n  return debounced\n}\n\nexport { debounce }\n\nexport default debounce\n","import debounce from './debounce'\n\nconst defaultGap = 128\n\nfunction throttle<A extends [], R>(func: (...args: A) => R, gap = defaultGap) {\n  if (gap <= 0 || !Number.isFinite(gap)) {\n    gap = defaultGap\n  }\n\n  return debounce(func, gap, { maxGap: gap, immediate: true })\n}\n\nexport { throttle }\n\nexport default throttle\n"],"names":["defaultGap","defaultOptions","maxGap","Infinity","immediate","debounce","func","gap","options","Number","isFinite","shouldExecute","gapTimer","maxGapTimer","lastReject","skipLastInvoke","clearTimeout","message","undefined","resetMaxGapTimer","setTimeout","resetForImmediateExecution","resetAfterExecution","execute","args","resolve","apply","handle","reject","bind","debounced","promise","Promise","reason","throttle"],"mappings":"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"}