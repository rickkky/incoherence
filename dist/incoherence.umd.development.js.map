{"version":3,"file":"incoherence.umd.development.js","sources":["../src/debounce.ts","../src/throttle.ts"],"sourcesContent":["const defaultGap = 128\n\nconst defaultOptions = {\n  maxGap: Infinity,\n  immediate: true,\n}\n\nfunction debounce<A extends [], R>(\n  func: (...args: A) => R,\n  gap = defaultGap,\n  options: Partial<typeof defaultOptions> = defaultOptions,\n) {\n  if (gap <= 0 || !Number.isFinite(gap)) {\n    gap = defaultGap\n  }\n\n  let { maxGap, immediate } = defaultOptions\n\n  if (options && options !== defaultOptions) {\n    if (\n      options.maxGap &&\n      Number.isFinite(options.maxGap) &&\n      options.maxGap >= gap\n    ) {\n      maxGap = options.maxGap\n    }\n\n    if (typeof options.immediate === 'boolean') {\n      immediate = options.immediate\n    }\n  }\n\n  let shouldExecute = immediate\n  let gapTimer: ReturnType<typeof setTimeout> | undefined\n  let maxGapTimer: ReturnType<typeof setTimeout> | undefined\n  let lastReject: ((reason?: any) => void) | undefined\n\n  function skipLastInvoke() {\n    if (gapTimer) {\n      clearTimeout(gapTimer)\n    }\n\n    if (lastReject) {\n      lastReject({ message: 'Cancelled by debounce.' })\n    }\n\n    gapTimer = undefined\n    lastReject = undefined\n  }\n\n  function resetMaxGapTimer() {\n    if (!Number.isFinite(maxGap)) {\n      return\n    }\n\n    if (maxGapTimer) {\n      clearTimeout(maxGapTimer)\n    }\n\n    maxGapTimer = setTimeout(() => {\n      shouldExecute = true\n    }, maxGap)\n  }\n\n  function resetForImmediateExecution() {\n    if (!immediate) {\n      return\n    }\n\n    gapTimer = setTimeout(() => {\n      shouldExecute = true\n    }, gap)\n  }\n\n  function resetAfterExecution() {\n    gapTimer = undefined\n    lastReject = undefined\n\n    resetMaxGapTimer()\n    resetForImmediateExecution()\n  }\n\n  function execute(this: any, args: A, resolve: (value?: R) => void) {\n    resolve(func.apply(this, args))\n    resetAfterExecution()\n  }\n\n  function handle(\n    this: any,\n    args: A,\n    resolve: (value?: R) => void,\n    reject: (reason?: any) => void,\n  ) {\n    skipLastInvoke()\n\n    if (shouldExecute) {\n      setTimeout(execute.bind(this, args, resolve), 0)\n      shouldExecute = false\n    } else {\n      gapTimer = setTimeout(execute.bind(this, args, resolve), gap)\n      lastReject = reject\n    }\n  }\n\n  function debounced(this: any, ...args: A): Promise<R> {\n    const promise = new Promise<R>(handle.bind(this, args))\n\n    promise.catch((reason) => reason)\n\n    return promise\n  }\n\n  return debounced\n}\n\nexport { debounce }\n\nexport default debounce\n","import debounce from './debounce'\n\nconst defaultGap = 128\n\nfunction throttle<A extends [], R>(func: (...args: A) => R, gap = defaultGap) {\n  if (gap <= 0 || !Number.isFinite(gap)) {\n    gap = defaultGap\n  }\n\n  return debounce(func, gap, { maxGap: gap, immediate: true })\n}\n\nexport { throttle }\n\nexport default throttle\n"],"names":["defaultGap","defaultOptions","maxGap","Infinity","immediate","debounce","func","gap","options","Number","isFinite","shouldExecute","gapTimer","maxGapTimer","lastReject","skipLastInvoke","clearTimeout","message","undefined","resetMaxGapTimer","setTimeout","resetForImmediateExecution","resetAfterExecution","execute","args","resolve","apply","handle","reject","bind","debounced","promise","Promise","reason","throttle"],"mappings":"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"}